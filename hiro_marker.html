<!DOCTYPE html>
<html>

<head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
    <!-- <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script>    -->
    <script src="js/aframe.min.js"></script>
    <!-- https://aframe.io/releases/1.2.0/aframe.min.js -->
    <!-- we import arjs version without NFT but with marker + location based support -->
    <script src="js/arframe-ar.js"></script>
    <!-- https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js -->

    <script>
        var time_limit = 0;
        var clue_title = [
            "Clue 01",
            "Clue 02",
            "Clue 03",
            "Clue 04",
            "Clue 05",
            "Clue 06",
            "Clue 07",
        ]

        var horcrux_names = [
            "Tom Riddle's Diary",
            "Resurrection Stone Ring",
            "Salazar Slytherin's Locket",
            "Helga Hufflepuff's Cup",
            "Rowena Ravenclaw's Diadem",
            "Nagini The Snake",
            "Harry Potter"
        ]
        var clues = ["Created in the girls bathroom on the first floor of Hogwarts, To find this clue you may have to look downwards!",
            "You can wear it in your hand, Oh! By the way, did you check out the All new OnePlus wrist band?",
            "Voldemort's mother originally owned this piece of ornament. If you want your 3rd clue, Please take the store manager's consent.",
            "Helga Hufflepuff owned this Horcrux. Don’t make a big fuss. Before you start looking through, Have a look at the latest OnePlus Nord 2.",
            "Rowena Ravenclaw wore this as a badge of Royalty. We display our logo ‘Never Settle’ with utmost loyalty.",
            "You need to learn Parseltongue to find the next clue. Just kidding, head to the checkout counter for review, upon finding this too, your 10% discount is definitely due.",
            "He who killed “the one who shall not be named”, Sit down and relax, if you don’t find this clue, You’re the one to be blamed."];

        var markers_found = [
            false,
            false,
            false,
            false,
            false,
            false,
            false,
        ];
        var startTime = new Date().getTime();

        AFRAME.registerComponent('registerevents', {
            init: function () {
                const marker = this.el;

                marker.addEventListener("markerFound", () => {
                    var markerId = marker.id;
                    var indicator_name = "#Indicator_" + markerId;
                    var model_name = "#Model_" + markerId;

                    console.log('Indicator: ', indicator_name);
                    console.log('Marker Found: ', markerId);

                    var marker_number = markerId[1];
                    markers_found[marker_number - 1] = true;
                    clue_title[marker_number - 1] = horcrux_names[marker_number - 1];

                    document.getElementById("clue-number").innerHTML = clue_title[marker_number - 1];
                    document.getElementById("clue-description").innerHTML = clues[marker_number - 1];
                    var indicator = document.querySelector(indicator_name);
                    indicator.style.boxShadow = "rgba(1, 120, 255, 1) 0px 0px 20px";

                    var all_found = true;
                    for (let index = 0; index < markers_found.length; index++) {
                        if (markers_found[index] === false) {
                            all_found = false;
                        }
                    }
                    console.log(markers_found);

                    if (all_found) {
                        //Win!!
                        document.getElementById('win-popup').style.display = 'flex';
                        document.getElementById('wp-img').src="resources/images/voldemort.png"
                        document.getElementById('wp-text').innerHTML="Yay! You did it";

                        var now = new Date().getTime();
                        var distance = now - startTime;
                        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                        var seconds = Math.floor((distance % (1000 * 60)) / 1000);

                        var total_time = minutes * 60 + seconds;
                        setTimeout(function () {

                            document.getElementById('win-popup').style.opacity = 1;
                            setTimeout(function () {
                                update_and_redirect('win', total_time);
                            }, 5000)
                        }, 50);

                    }
                });

                marker.addEventListener("markerLost", () => {
                    var markerId = marker.id;
                    console.log('Marker Lost: ', markerId);
                });
            },
        });


        function button_click(number) {
            document.getElementById("clue-number").innerHTML = clue_title[number - 1];
            document.getElementById("clue-description").innerHTML = clues[number - 1];
        }

        setInterval(function () {
            var now = new Date().getTime();

            var distance = now - startTime;

            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById("timercounter").innerHTML = minutes.toString().padStart(2, "0") + ":" + seconds.toString().padStart(2, "0");

            if (minutes >= time_limit) {
                //Timeout
                //Lost
                document.getElementById('win-popup').style.display = 'flex';
                document.getElementById('wp-img').src="resources/images/voldemort_laugh2.png";
                document.getElementById('wp-text').innerHTML="Oh No! Timeout";
                setTimeout(function () {
                    document.getElementById('win-popup').style.opacity = 1;
                    setTimeout(function () {
                        update_and_redirect('lose', -1);
                    }, 5000)
                }, 50);
            }

        }, 1000);

        async function update_and_redirect(result, total_time) {
            sessionStorage.setItem("op-hp-ar-userscore", total_time);
            if (result === 'win') {

                window.location.href = "success.html";
            }
            else {
                window.location.href = "failure.html";
            }

            // var user_id = sessionStorage.getItem('op-hp-ar-userid');
            // const response = await fetch('https://steponexp.net/game12/update.php?id=' + user_id + '&score=' + total_time, {
            //     method: 'GET'
            // }).then(response => {
            //     console.log("Response", response);
            //     window.location.href = "http://localhost:5500/failure.html";
            // });

            // var total_time = time_limit * 60;
            // sessionStorage.setItem("op-hp-ar-userscore", total_time);

            // var user_id = sessionStorage.getItem('op-hp-ar-userid');
            // const response = await fetch('https://steponexp.net/game12/update.php?id=' + user_id + '&score=-1', {
            //     method: 'GET'
            // }).then(response => {
            //     console.log("Response", response);
            //     window.location.href = "http://localhost:5500/failure.html";
            // });
        }

        function show(shown, hidden) {
            document.getElementById(shown).style.display = 'block';
            document.getElementById(hidden).style.display = 'none';
            return false;
        }

        function openNav() {
            // console.log("In Open");
            document.getElementById("bottom-drawer").style.transform = "translateY(0em)";
            document.getElementById("toggleslide").setAttribute('onClick', "closeNav()");
            document.getElementById("toggleslide").innerHTML = 'expand_more';
        }

        function closeNav() {
            // console.log("In Close");
            var translate_height = document.getElementById("bottom-drawer").offsetHeight - (document.getElementById("collapsebutton").offsetHeight + document.getElementById("clue-number").offsetHeight + document.getElementById("clue-description").offsetHeight);
            console.log("Down pix: ", translate_height);
            document.getElementById("bottom-drawer").style.transform = "translateY(" + translate_height + "px)";
            document.getElementById("toggleslide").setAttribute('onClick', "openNav()");
            document.getElementById("toggleslide").innerHTML = 'expand_less';
        }

    </script>
    <style>
        @font-face {
            font-family: OnePlusSans;
            src: url("resources/font/OnePlusSans/OnePlusSans-Regular.ttf");
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: OnePlusSans;
            src: url("resources/font/OnePlusSans/OnePlusSans-Bold.ttf");
            font-weight: bold;
            font-style: normal;
        }

        @font-face {
            font-family: OnePlusSans;
            src: url("resources/font/OnePlusSans/OnePlusSans-Light.ttf");
            font-weight: lighter;
            font-style: normal;
        }

        @font-face {
            font-family: OnePlusSans;
            src: url("resources/font/OnePlusSans/OnePlusSans-Medium.ttf");
            font-weight: 800;
            font-style: normal;
        }

        @font-face {
            font-family: OnePlusSans;
            src: url("resources/font/OnePlusSans/OnePlusSans-Black.ttf");
            font-weight: 500;
            font-style: normal;
        }

        body {
            background-color: black;
            font-family: OnePlusSans;
        }

        .slideup {
            -webkit-user-select: none;
            /* Safari */
            -ms-user-select: none;
            /* IE 10 and IE 11 */
            user-select: none;
            /* Standard syntax */

            justify-content: center;
            text-align: center;

            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40%;
            background: white;

            z-index: 10;
            border-radius: 2em 2em 0 0;

            transition: 0.5s;

        }

        .slideup .material-icons {
            color: gray;
        }

        .collapsebutton {
            justify-content: center;
            text-align: center;
            width: 100%;
        }

        #clue-description {
            padding: 10px;
            padding-top: 2.5px;
            font-size: 20px;
        }

        #container {
            margin-left: 30px;
            margin-right: 30px;
            /* bottom: 0;
            left: 0;
            right: 0;
            position: absolute; */

            display: flex;
            flex-wrap: wrap;
            justify-content: center;

        }

        /*flex-basis: calc(16.666% - 20px);*/
        /* .item {
            
            border-radius: 50%;
            background-color: white;
            padding: 20px;
            margin: 10px;

            height: 15px;
            width: 15px;

            text-align: center;
            border: 2px solid rgb(255, 0, 0);
            color: rgb(255, 1, 1);

            
            font: 20px "Roboto", sans-serif;

        } */

        .item {
            border-radius: 50%;
            width: 25px;
            height: 25px;

            padding: 5px;
            margin: 10px;

            background: #fff;
            border: 3px solid #F50514;

            /* box-shadow: rgba(1, 120, 255, 1) 0px 0px 17px; */
            color: #F50514;
            text-align: center;
            font-size: 18px;
            font-weight: bold;

            transition: all 1s ease-out;
        }


        .timerbar {
            background: black;
            color: white;
            display: flex;

            position: absolute;
            height: 10%;
            width: 100%;
            top: 0;
            left: 0;
            z-index: 10;

            align-items: center;
        }

        .companylogo {
            padding: 10px;
            margin: 10px;
            object-fit: contain;
            width: 7em;
        }

        .timerside {
            right: 0;
            position: absolute;
            display: flex;


            padding: 10px;
            margin: 10px;
        }

        .timercounter {
            font-size: 22px;
        }

        .material-icons {
            color: #F50514;
            padding-top: 3px;
            padding-right: .2em;
        }

        #win-popup {
            /* transform: translate(-.5em, -.5em); */
            z-index: 20;

            position: absolute;
            width: 100%;
            height: 100%;
            left: 0;
            bottom: 0;
            margin-bottom: 50px;

            display: flex;

            justify-content: center;
            align-items: center;
            text-align: center;

            opacity: 0;
            transition: all 0.5s ease-in;
        }

        #win-popup #wp-bg {
            background-color: black;
            padding: 15px;
            border-radius: 10px;
        }

        #win-popup img {
            object-fit: contain;
            width: 10em;
        }

        #win-popup p {
            background-color: black;
            font-size: 24px;
            color: white;
        }
    </style>
</head>

<body style="margin : 0px; overflow: hidden; background-color: white;">

    <div id="win-popup" style="display: none;">
        <div id=wp-bg>
            <img id="wp-img" src="resources/images/voldemort.png">
            <p id="wp-text">Yay! You did it</p>
        </div>
    </div>
    <!--Timer Bar-->
    <div class="timerbar">
        <div class="companylogo">
            <img src="resources/images/op-logo.svg" style="max-width: 100%;">
        </div>
        <div class="timerside">
            <span class="material-icons">timer</span>
            <div class="timercounter" id="timercounter">00:01</div>
        </div>

    </div>
    <!--UI Part-->
    <div class="slideup" id="bottom-drawer">
        <div class="collapsebutton" id="collapsebutton"><span class="material-icons" id="toggleslide"
                onclick="closeNav()">expand_more</span>
        </div>
        <div id="clue-number" style="font-size: 24px; font-weight: bold; color: #F50514;">Clue 01</div>
        <div id="clue-description">Created in the girls bathroom on the first floor of Hogwarts, To find this clue
            you
            may have to look downwards!</div>
        <div id="container">
            <div class="item" id="Indicator_M1" onclick="button_click(01);">01</div>
            <div class="item" id="Indicator_M2" onclick="button_click(02);">02</div>
            <div class="item" id="Indicator_M3" onclick="button_click(03);">03</div>
            <div class="item" id="Indicator_M4" onclick="button_click(04);">04</div>
        </div>
        <div id="container">
            <div class="item" id="Indicator_M5" onclick="button_click(05);">05</div>
            <div class="item" id="Indicator_M6" onclick="button_click(06);">06</div>
            <div class="item" id="Indicator_M7" onclick="button_click(07);">07</div>
        </div>
    </div>

    <!--Camera Part-->
    <a-scene vr-mode-ui="enabled: false" color-space="sRGB" renderer="gammaOutput: true" embedded
        arjs='debugUIEnabled: false; sourceType: webcam; patternRatio: 0.85; trackingMethod: best;'>

        <a-marker registerevents preset='custom' type='pattern' url="resources\markers\pattern-Individual_Blocks-1.patt"
            id="M1">
            <!-- <a-box position='0 0.5 0' material='opacity: 0.5; side:double; color:white;'>
                <a-torus-knot radius='0.26' radius-tubular='0.05' color='blue'
                    animation="property: rotation; to:360 0 0; dur: 5000; easing: linear; loop: true">
                </a-torus-knot>
            </a-box> -->
            <a-entity material="shader: flat;" id="directionaltarget" shadow="receive: false; cast: false"
                gltf-model="resources\models\diary.glb" rotation='0 -45 0' scale='0 0 0'
                animation="property: rotation; to:0 -45 360; dur: 10000; easing: linear; loop: true"
                animation__2="property: scale; to:0.5 0.5 0.5; dur: 3000; easing: easeInOutElastic;"></a-entity>
        </a-marker>

        <a-marker registerevents preset='custom' type='pattern' url="resources\markers\pattern-Individual_Blocks-2.patt"
            id="M2">
            <!-- <a-sphere position='0 0.5 0' material='opacity: 0.5; side:double; color:white;'>
                <a-torus-knot radius='0.26' radius-tubular='0.05' color='blue'
                    animation="property: rotation; to:360 0 0; dur: 5000; easing: linear; loop: true">
                </a-torus-knot>
                </a-box> -->
            <a-entity id="Model_M2" gltf-model="resources\models\ring.glb" rotation='-45 0 0' scale='0.1 0.1 0.1'
                animation="property: rotation; to:-45 0 360; dur: 10000; easing: linear; loop: true"></a-entity>
        </a-marker>

        <a-marker registerevents preset='custom' type='pattern' url="resources\markers\pattern-Individual_Blocks-3.patt"
            id="M3">
            <!-- <a-sphere position='0 0.5 0' material='opacity: 0.5; side:double; color:white;'>
                <a-torus-knot radius='0.26' radius-tubular='0.05' color='#F50514'
                    animation="property: rotation; to:360 0 0; dur: 5000; easing: linear; loop: true">
                </a-torus-knot>
                </a-box> -->
            <a-entity gltf-model="resources\models\ring.glb" rotation='-45 0 0' scale='0.1 0.1 0.1'
                animation="property: rotation; to:-45 0 360; dur: 10000; easing: linear; loop: true"></a-entity>
        </a-marker>
        <a-marker registerevents preset='custom' type='pattern' url="resources\markers\pattern-Individual_Blocks-4.patt"
            id="M4">
            <!-- <a-sphere position='0 0.5 0' material='opacity: 0.5; side:double; color:white;'>
            <a-torus-knot radius='0.26' radius-tubular='0.05' color='#F50514'
                animation="property: rotation; to:360 0 0; dur: 5000; easing: linear; loop: true">
            </a-torus-knot>
            </a-box> -->
            <a-entity gltf-model="resources\models\ring.glb" rotation='-45 0 0' scale='0.1 0.1 0.1'
                animation="property: rotation; to:-45 0 360; dur: 10000; easing: linear; loop: true"></a-entity>
        </a-marker>
        <a-marker registerevents preset='custom' type='pattern' url="resources\markers\pattern-Individual_Blocks-5.patt"
            id="M5">
            <!-- <a-sphere position='0 0.5 0' material='opacity: 0.5; side:double; color:white;'>
        <a-torus-knot radius='0.26' radius-tubular='0.05' color='#F50514'
            animation="property: rotation; to:360 0 0; dur: 5000; easing: linear; loop: true">
        </a-torus-knot>
        </a-box> -->

            <a-entity id="diadem" gltf-model="resources\models\diadem.glb" rotation='0 0 0' scale='0.01 0.01 0.01'
                animation="property: rotation; to:0 360 0; dur: 10000; easing: linear; loop: true">
            </a-entity>
        </a-marker>
        <a-marker registerevents preset='custom' type='pattern' url="resources\markers\pattern-Individual_Blocks-6.patt"
            id="M6">
            <!-- <a-sphere position='0 0.5 0' material='opacity: 0.5; side:double; color:white;'>
    <a-torus-knot radius='0.26' radius-tubular='0.05' color='#F50514'
        animation="property: rotation; to:360 0 0; dur: 5000; easing: linear; loop: true">
    </a-torus-knot>
    </a-box> -->
            <a-entity gltf-model="resources\models\snake.glb" position='-1 0 1' rotation='0 0 0' scale='1 1 1'
                elasticity="1000"></a-entity>
        </a-marker>
        <a-marker registerevents preset='custom' type='pattern' url="resources\markers\pattern-Individual_Blocks-7.patt"
            id="M7">
            <!-- <a-sphere position='0 0.5 0' material='opacity: 0.5; side:double; color:white;'>
    <a-torus-knot radius='0.26' radius-tubular='0.05' color='#F50514'
        animation="property: rotation; to:360 0 0; dur: 5000; easing: linear; loop: true">
    </a-torus-knot>
    </a-box> -->
            <a-entity gltf-model="resources\models\harry.glb" rotation='0 0 0'
                animation="property: rotation; to:0 360 0; dur: 10000; easing: linear; loop: true"></a-entity>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>
</body>

</html>